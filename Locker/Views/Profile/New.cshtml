
@{
    ViewBag.Title = "New";
}
<style>
    [v-cloak] {
        display: none;
    }
</style>
<div id="app" v-cloak>
    <div class="row d-print-none" style="background-color: #f6f7f8 !important;">
        <div class="col-md-8">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb" style="padding-bottom: 0px; margin-bottom: 0px; background-color: #f6f7f8 !important;">
                    <li class="breadcrumb-item"><i class="fa fa-home">&nbsp;</i><a href="#">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Profile</li>
                </ol>
            </nav>
            <h4 style="padding-left: 15px;">Profile</h4>
        </div>
    </div>
    <div style="margin-top:20px;">
        <div class="alert alert-success alert-dismissible fade show" role="alert" v-cloak v-show="alertMessage" style="margin-top: 20px;">
            {{alertMessage}}
            <button type="button" class="close" v-on:click="closeAlertMessage('alertMessage')" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <div v-cloak class="alert alert-danger alert-dismissible fade show" role="alert" v-show="alertFailureMessage" style="margin-top: 20px;">
            {{alertFailureMessage}}
            <button type="button" class="close" v-on:click="closeAlertMessage('alertFailureMessage')" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>
  
            <div class="row">
                <div class="col-md-6 offset-md-3">
                    <div class="card justify-content-center">
                        <div class="card-body" style="font-size:14px;">
                                <div class="form-group row">
                                    <label class="col-md-2">Business Name</label>
                                    <div class="col-md-10">
                                        <input type="text" class="form-control" v-model="BusinessName">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-md-2">Owner</label>
                                    <div class="col-md-10">
                                        <input type="text" class="form-control" v-model="Owner">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2">GSTIN</label>
                                    <div class="col-sm-10">
                                        <input type="number" class="form-control" v-model="GSTIN">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2">Mobile No.</label>
                                    <div class="col-sm-10">
                                        <input type="number" class="form-control" v-model="MobileNumber">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2">Email</label>
                                    <div class="col-sm-10">
                                        <input type="email" class="form-control" v-model="Email">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2">Address</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" v-model="Address"></textarea>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-10">
                                        <button class="btn btn-primary" v-on:click="saveProfile()">Save</button>
                                    </div>
                                </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        var obj = {
            alertFailureMessage: "",
            alertMessage: "",
            BusinessName: "",
            Owner: "",
            GSTIN: "",
            MobileNumber: "",
            Email: "",
            Address: "",
            Id: 0
        }
        new Vue({
            el: '#app',
            data: obj,
            methods: {
                saveProfile: function (e) {
                    var self = this;
                    var endPoint = this.Id > 0 ? "/Profile/Edit" : "/Profile/Save";
                    var formData = {
                        BusinessName: this.BusinessName,
                        Owner: this.Owner,
                        GSTIN: this.GSTIN,
                        MobileNumber: this.MobileNumber,
                        Email: this.Email,
                        Address: this.Address,
                        Id: this.Id
                    }
                    $.post(endPoint,
                        formData,
                        function (res) {
                            self.Id = res.Id;
                            self.alertMessage = res.Message;
                            $(".navbar-brand").text(self.BusinessName);
                            $(".user-name").text(self.Owner);
                        }).fail(function (res) {
                            self.alertFailureMessage = res;
                        });
                },
                closeAlertMessage: function (property) {
                    // set alert message to empty
                    this[property] = "";
                },
            },
            computed: {
            },
            mounted() {
                $(".nav-link-profile").addClass("active");
                var self = this;
                $.get("/Profile/Get",
                    function (res) {
                        console.log(res);
                        if (res) {
                            self.BusinessName = res.BusinessName;
                            self.Owner = res.Owner;
                            self.GSTIN = res.GSTIN;
                            self.MobileNumber = res.MobileNumber;
                            self.Email = res.Email;
                            self.Address = res.Address;
                            self.Id = res.Id;
                        }
                    }).fail(function () {
                        self.alertFailureMessage = "Internal server error";
                    });
            }
        });
    });
</script>